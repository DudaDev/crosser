!function(e){function s(i){if(t[i])return t[i].exports;var n=t[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}var t={};return s.m=e,s.c=t,s.p="",s(0)}([function(e,s,t){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(s,"__esModule",{value:!0});var n=t(1),r=i(n),o=t(2),a=i(o),l=a["default"]({Promise:r["default"]});window&&(window.Crosser=l),s["default"]=l,e.exports=s["default"]},function(e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s["default"]=Promise,e.exports=s["default"]},function(e,s){"use strict";function t(e,s){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(s,"__esModule",{value:!0});var i=function(){function e(e,s){for(var t=0;t<s.length;t++){var i=s[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(s,t,i){return t&&e(s.prototype,t),i&&e(s,i),s}}();s["default"]=function(e){function s(){return(new Date).getTime().toString()}var n=e.Promise,r=function(){function e(i,n){if(t(this,e),this._sessionHandlers={},this._listeners={},this._otherFrameWindow=i,this._otherOrigin=n||"*",this._id=s(),this._events={},!this._otherFrameWindow||!this._otherFrameWindow.postMessage)throw new Error("Missing frame to communicate with");window.addEventListener("message",this.receiveMessage.bind(this),!1)}return i(e,[{key:"receiveMessage",value:function(e){var s=e.data,t=this.doesOriginMatch(e.origin);t&&s&&("event"===s.type?s.eventName&&this._events[s.eventName]&&this.fireEvent(e):s.sessionName&&this._sessionHandlers[s.sessionName]&&s.creator===this._id?this.endSession(e):s.sessionName&&s.creator!==this._id&&this.throwBackSession(e))}},{key:"doesOriginMatch",value:function(e){var s=e===this._otherOrigin||"*"===this._otherOrigin&&window.location.origin===e;return s}},{key:"endSession",value:function(e){var s=e.data,t=this._sessionHandlers[s.sessionName].resolve,i=this._sessionHandlers[s.sessionName].reject;this.deleteSession(s.sessionName),s.error?i(s.error):t(s.payload)}},{key:"throwBackSession",value:function(e){var s=e.data,t=s.sessionName;Object.keys(this._listeners[t]||{}).forEach(function(e){var i=this._listeners[t][e](s.payload);i&&i.then?i.then(function(e){this.postMessage({sessionName:t,payload:e,creator:s.creator})}.bind(this)):this.postMessage({sessionName:t,payload:i,creator:s.creator})},this)}},{key:"postMessage",value:function(e){this._otherFrameWindow.postMessage(e,this._otherOrigin)}},{key:"deleteSession",value:function(e){this._sessionHandlers[e].resolve=null,delete this._sessionHandlers[e].resolve,this._sessionHandlers[e].reject=null,delete this._sessionHandlers[e].reject,this._sessionHandlers[e]=null,delete this._sessionHandlers[e]}},{key:"destroy",value:function(){Object.keys(this._listeners||{}).forEach(this.unsubscribe,this),Object.keys(this._sessionHandlers||{}).forEach(this.deleteSession,this),this._otherFrameWindow=null,this._otherOrigin=null,this._id=null}},{key:"trigger",value:function(e,s){var t;if(this._sessionHandlers[e])throw new Error("A session with the name "+e+" is still alive");return t=new n(function(s,t){this._sessionHandlers[e]={resolve:s,reject:t}}.bind(this)),this.postMessage({sessionName:e,payload:s,creator:this._id}),t}},{key:"abort",value:function(e){this.deleteSession(e)}},{key:"subscribe",value:function(e,t){var i=s();if(this._listeners[e]=this._listeners[e]||{},Object.keys(this._listeners[e]||{}).length>0)throw new Error("A session ( "+e+" ) can have only one subscriber");return this._listeners[e][i]=t,i}},{key:"unsubscribe",value:function(e,s){s?(this._listeners[e][s]=null,delete this._listeners[e][s]):Object.keys(this._listeners[e]||{}).forEach(this.unsubscribe.bind(this,e))}},{key:"fireEvent",value:function(e){var s=e.data;this._events[s.eventName].forEach(function(e){e(s.payload)})}},{key:"subscribeEvent",value:function(e,s){this._events[e]=this._events[e]||[],this._events[e].push(s)}},{key:"unsubscribeEvent",value:function(e){this._events[e]=null,delete this._events[e]}},{key:"triggerEvent",value:function(e,s){this.postMessage({eventName:e,type:"event",payload:s,creator:this._id})}}]),e}();return r},e.exports=s["default"]}]);